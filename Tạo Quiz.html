<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>T·∫°o Quiz √în T·∫≠p </title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #257ec2;
        margin: 0;
        padding: 20px;
        font-size: 3dvh;
    }
    .container {
        max-width: 900px;
        margin: auto;
        background: rgb(8, 4, 4);
        padding: 20px;
        border-radius: 8px;
        color: white;
    }
    textarea {
        width: 100%;
        height: 200px;
        padding: 12px;
        font-size: 20px;
    }
    button {
        padding: 12px 18px;
        margin: 10px 5px;
        cursor: pointer;
        border:none;
        border-radius:6px;
        font-size: 18px;
        background: #2c7aed;
        color: white;
    }
    h2, h3, h4 {
        font-size: 24px;
        color: white;
        margin-top: 0;
    }

    /* tƒÉng size ch·ªØ c√¢u h·ªèi */
    .question {
        margin-top: 20px;
        padding: 20px;
        border-radius: 8px;
        background: #f6f8fb;
        border-left: 5px solid #407bff;
        font-size: 24px;
        color: black;
    }

    .question b {
        font-size: 26px;
    }

    label {
        display: block;
        margin: 5px 0;
        font-size: 22px;
    }

    input[type=radio] {
        transform: scale(2);
        margin-right: 8px;
    }

    .wrong {
        background: #ffecec;
        padding: 10px;
        margin: 8px 0;
        border-left: 5px solid red;
        border-radius: 6px;
        font-size: 20px;
        color: black;
    }

    #result {
        margin-top: 20px;
        font-size: 22px;
        color: white;
    }
    #hideHelpBtn {
    position: fixed;
    top: 15px;
    right: 130px;
    padding: 10px 18px;
    background: #ca2222;
    color:white;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
    z-index:11000;
    font-weight: 600;
}

#helpOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 12000;
}
#helpBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    padding: 10px 18px;
    background: #ff9800;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    z-index: 11000;
}
#helpOverlay video {
    max-width: 90%;
    max-height: 80%;
    border-radius: 12px;
}
#closeHelp {
    margin-top: 20px;
    padding: 12px 20px;
    background: #e53935;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
}
</style>
</head>
<body>
<button id="hideHelpBtn" onclick="hideHelpBtnFunction()">X</button>

<!-- N√öT H∆Ø·ªöNG D·∫™N -->
<button id="helpBtn" onclick="showHelp()">H∆∞·ªõng d·∫´n</button>

<!-- OVERLAY VIDEO -->
<div id="helpOverlay">
    <video id="helpVideo" controls>
        <source src="t·∫°o quiz (1).mp4" type="video/mp4">
    </video>
    <button id="closeHelp" onclick="closeHelp()">ƒê√≥ng</button>
</div>
<div class="container">
    <h2>üìò T·∫°o Quiz √în T·∫≠p</h2>

    <div id="inputBox" style="width: 95%;">
        <textarea id="inputData" placeholder="D√°n c√¢u h·ªèi + ƒë√°p √°n ·ªü ƒë√¢y"></textarea>
        <button onclick="generateQuiz()">T·∫°o Quiz</button>
    </div>
    <!-- ‚≠ê KH·ªêI CH√öC B·∫†N L√ÄM B√ÄI T·ªêT + N√öT SAO CH√âP -->
<!-- ‚≠ê KH·ªêI CH√öC B·∫†N L√ÄM B√ÄI T·ªêT + FORM T·∫†O BI·ªÇU M·∫™U -->
<div id="goodLuckBox" style="
    display: block;
    margin-top: 10px;
    background: #ffffff;
    padding: 12px;
    border-left: 5px solid #2c7aed;
    border-radius: 6px;
    color: black;
    font-size: 20px;
">
    <b style="background-color: aquamarine;padding: 10px;border-radius: 8px;margin-bottom: 10px;">üéâ T·∫°o bi·ªÉu m·∫´u:</b>
    
<br>
    <!-- ‚≠ê TH√äM M·ªöI T·∫†I ƒê√ÇY -->
    <div style="margin-top: 20px; font-size: 18px;">
        <label style="font-weight: 600;font-family: Arial, Helvetica, sans-serif;">S·ªë c√¢u: 
            <input id="soCau" type="number" style="padding:6px; width:90px; font-size:18px;border: 2px solid black;">
        </label>

        <label style="font-weight: 600;font-family: Arial, Helvetica, sans-serif;">M√¥n:
            <input id="monHoc" type="text" style="padding:6px; width:250px; font-size:18px;border: 2px solid black;">
        </label>

        <button onclick="taoBieuMau()" style="
            padding: 6px 12px;
            background:#f11313;
            color:rgb(245, 245, 245);
            border:none;
            border-radius:4px;
            cursor:pointer;
            font-size:16px;
            font-weight: 600;
        ">T·∫°o bi·ªÉu m·∫´u</button>
    </div>

    <!-- K·∫æT QU·∫¢ BI·ªÇU M·∫™U + N√öT COPY -->
    <div id="mauOutput" style="margin-top:15px; white-space:pre-line; font-size:18px;"></div>
</div>

<script>
function taoBieuMau(){
    const soCau = document.getElementById("soCau").value.trim();
    const monHoc = document.getElementById("monHoc").value.trim();
    let output = document.getElementById("mauOutput");

    if(!soCau || !monHoc){
        output.innerHTML = "<div style='color:red;'>‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!</div>";
        return;
    }

    let text =
`T·∫°o cho t√¥i ${soCau} c√¢u h·ªèi m√¥n ${monHoc} d·∫°ng tr·∫Øc nghi·ªám nh∆∞ sau:
A.
B.
C.
D.
ƒê√°p √°n:`;   

    output.innerHTML = `
        <div id="mauText" style="
            background:#f6f8fb;
            padding:12px;
            border-left:5px solid #2c7aed;
            border-radius:6px;
            color:black;
            white-space: pre-line;
        ">${text}</div>

        <button id="copyBtn" style="
            margin-top:8px;
            padding:6px 12px;
            background:#2c7aed;
            color:white;
            border:none;
            border-radius:4px;
            cursor:pointer;
            font-size:16px;
        ">üìã Sao ch√©p vƒÉn b·∫£n</button>
    `;

    document.getElementById("copyBtn").onclick = function(){
        const textToCopy = document.getElementById("mauText").textContent;

        // Th·ª≠ d√πng Clipboard API tr∆∞·ªõc
        if(navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(textToCopy).then(() => {
                alert("ƒê√£ sao ch√©p!");
            }).catch(() => fallbackCopy(textToCopy));
        } else {
            fallbackCopy(textToCopy);
        }
    };

    function fallbackCopy(text){
        // T·∫°o textarea t·∫°m ƒë·ªÉ copy
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            alert("ƒê√£ sao ch√©p!");
        } catch(e){
            alert("Sao ch√©p th·∫•t b·∫°i!");
        }
        document.body.removeChild(textarea);
    }
}


function copyMau(){
    navigator.clipboard.writeText(window.generatedText);
    alert("ƒê√£ sao ch√©p!");
}
</script>



    <form id="quizForm"></form>

    <button id="endBtn" style="display:none;" onclick="submitQuiz()">K·∫øt th√∫c b√†i</button>
    <button id="retryBtn" style="display:none;" onclick="retryQuiz()">L√†m l·∫°i b√†i</button>
    <button id="newQuizBtn" style="display:none;" onclick="newQuiz()">T·∫°o l·∫°i c√¢u h·ªèi</button>

    <div id="result"></div>
</div>

<script>
    function showHelp(){
    document.getElementById("helpOverlay").style.display = "flex";
    const v=document.getElementById("helpVideo");
    v.currentTime = 0;
    v.play();
}

function closeHelp(){
    document.getElementById("helpOverlay").style.display = "none";
    document.getElementById("helpVideo").pause();
}

// ·∫®N C·∫¢ 2 N√öT
function hideHelpBtnFunction(){
    document.getElementById("helpBtn").style.display = "none";
    document.getElementById("hideHelpBtn").style.display = "none";
}
   

let quizData = [];

function generateQuiz() {
    const text = document.getElementById("inputData").value.trim();
    if (!text) return alert("Vui l√≤ng nh·∫≠p c√¢u h·ªèi!");
    document.getElementById("goodLuckBox").style.display = "none";


    // 1. T√°ch t·∫•t c·∫£ c√°c d√≤ng v√† lo·∫°i b·ªè d√≤ng tr·ªëng
    const lines = text
    .split("\n")
    .map(l => l.trim())
    .filter(l => l !== "" && l !== "---"); // lo·∫°i b·ªè c√°c d√≤ng --- ho√†n to√†n


    quizData = [];
    let errorList = [];
    let currentBlock = [];

    lines.forEach((line, idx) => {
    currentBlock.push(line);

    // N·∫øu d√≤ng c√≥ "ƒê√°p √°n:", coi nh∆∞ k·∫øt th√∫c 1 c√¢u
    if (/^ƒê√°p √°n[:\s]/i.test(line)) {
        let questionLine = currentBlock[0] || "";
        let options = currentBlock.slice(1, -1); // t·∫•t c·∫£ d√≤ng tr·ª´ c√¢u h·ªèi v√† ƒë√°p √°n
        let answerLine = currentBlock[currentBlock.length - 1];

        // X·ª≠ l√Ω lo·∫°i b·ªè k√Ω t·ª± l·∫° __, --, **
        const cleanText = (text) => text.replace(/(__+|--+|\*\*+|~~+|@@+|!!+|,,+|;;+)/g, "").trim();


        questionLine = cleanText(questionLine);
        options = options.map(opt => cleanText(opt));
        let correct = cleanText(answerLine.replace(/^ƒê√°p √°n[:\s]*/i, ""));

        if (!correct) {
            errorList.push(quizData.length + 1);
        }

        // X·ª≠ l√Ω A, B, C, D n·∫øu c√≥ d·∫•u : ho·∫∑c .
        let A = options[0] ? options[0].replace(/^A[:.]\s*/, "").trim() : "";
        let B = options[1] ? options[1].replace(/^B[:.]\s*/, "").trim() : "";
        let C = options[2] ? options[2].replace(/^C[:.]\s*/, "").trim() : "";
        let D = options[3] ? options[3].replace(/^D[:.]\s*/, "").trim() : "";

        quizData.push({
            question: questionLine,
            A, B, C, D,
            correct
        });

        currentBlock = []; // reset cho c√¢u ti·∫øp theo
    }
});


    if (errorList.length > 0) {
        document.getElementById("result").innerHTML = `
            <div class="wrong" style="background:#fff3cd; border-left:5px solid orange; color:black;">
                ‚ö†Ô∏è L·ªói n·ªôi dung ·ªü c√¢u s·ªë: ${errorList.join(', ')}. Vui l√≤ng ki·ªÉm tra l·∫°i!
            </div>
        `;
        return;
    }

    document.getElementById("inputBox").style.display = "none";
    renderQuiz();
}


function renderQuiz(){
    const quizForm = document.getElementById("quizForm");
    quizForm.innerHTML="";

    quizData.forEach((q, idx)=>{
        let div = document.createElement("div");
        div.className="question";
        div.innerHTML = `
            <b>${q.question}</b><br><br>
            <label><input type="radio" name="q${idx}" value="A">A. ${q.A}</label>
            <label><input type="radio" name="q${idx}" value="B">B. ${q.B}</label>
            <label><input type="radio" name="q${idx}" value="C">C. ${q.C}</label>
            <label><input type="radio" name="q${idx}" value="D">D. ${q.D}</label>
        `;
        quizForm.appendChild(div);
    });

    document.getElementById("endBtn").style.display = "inline-block";
    document.getElementById("retryBtn").style.display = "none";
    document.getElementById("newQuizBtn").style.display = "none";
    document.getElementById("result").innerHTML = "";
}

function submitQuiz(){
    const quizForm = document.getElementById("quizForm");
    const divs = quizForm.querySelectorAll(".question");

    let correctCount = 0;
    let wrongList = [];
    let missingAnswerList = []; // danh s√°ch c√¢u ch∆∞a c√≥ ƒë√°p √°n

    divs.forEach((div, idx)=>{
        let correctAns = quizData[idx].correct;
        const checked = div.querySelector("input[type=radio]:checked");

        // n·∫øu kh√¥ng c√≥ ƒë√°p √°n, th√™m v√†o danh s√°ch missingAnswerList
        if(!correctAns) {
            missingAnswerList.push(idx+1); // l∆∞u s·ªë th·ª© t·ª± c√¢u h·ªèi
            correctAns = "(Kh√¥ng c√≥ ƒë√°p √°n)";
        }

        // t√¥ m√†u ƒë·ªè cho ƒë√°p √°n ƒë√∫ng n·∫øu c√≥
        if(correctAns !== "(Kh√¥ng c√≥ ƒë√°p √°n)"){
            let labels = div.querySelectorAll("label");
            labels.forEach(lb=>{
                let inp = lb.querySelector("input");
                if(inp.value === correctAns){
                    lb.style.color = "red";
                    lb.style.fontWeight = "bold";
                }
            });
        }

        if(checked && checked.value === correctAns){
            correctCount++;
        } else {
            wrongList.push({
                q: quizData[idx].question,
                chosen: checked ? checked.value : "(Kh√¥ng ch·ªçn)",
                correct: correctAns
            });
        }
    });

    let total = quizData.length;
    let percent = Math.round((correctCount/total)*100);
    let grade = Math.round(((correctCount/total)*10)*100)/100;

    let html = `
        <h3>üéØ K·∫øt qu·∫£</h3>
        <p>üëâ ƒê√∫ng: <b>${correctCount}/${total}</b></p>
        <p>üìä Ch√≠nh x√°c: <b>${percent}%</b></p>
        <p>üèÜ ƒêi·ªÉm: <b>${grade}/10</b></p>
    `;

    if(wrongList.length>0){
        html += `<h4>‚ùó C√°c c√¢u sai</h4>`;
        wrongList.forEach((w,i)=>{
            html += `
                <div class="wrong">
                    <b>${w.q}</b><br>
                    ‚û§ B·∫°n ch·ªçn: <b>${w.chosen}</b><br>
                    ‚úî ƒê√°p √°n ƒë√∫ng: <b>${w.correct}</b>
                </div>`;
        });
    }

    // hi·ªÉn th·ªã c·∫£nh b√°o c√¢u ch∆∞a c√≥ ƒë√°p √°n
    if(missingAnswerList.length > 0){
        html += `<div class="wrong" style="background:#fff3cd; border-left:5px solid orange; color:black;">
            ‚ö†Ô∏è C√¢u h·ªèi ch∆∞a c√≥ ƒë√°p √°n: ${missingAnswerList.join(', ')}. Vui l√≤ng th√™m ƒë√°p √°n ƒë·ªÉ ch·∫•m ch√≠nh x√°c.
        </div>`;
    }

    document.getElementById("result").innerHTML = html;

    document.getElementById("retryBtn").style.display = "inline-block";
    document.getElementById("newQuizBtn").style.display = "inline-block";
    document.getElementById("endBtn").style.display = "none";
}


function retryQuiz(){
    renderQuiz();
}

function newQuiz(){
    quizData = [];
    document.getElementById("inputBox").style.display = "block";
     document.getElementById("goodLuckBox").style.display = "block"; // ‚úÖ hi·ªÉn th·ªã l·∫°i kh·ªëi t·∫°o bi·ªÉu m·∫´u
    document.getElementById("quizForm").innerHTML = "";
    document.getElementById("result").innerHTML = "";
    document.getElementById("endBtn").style.display = "none";
    document.getElementById("retryBtn").style.display = "none";
    document.getElementById("newQuizBtn").style.display = "none";
    document.getElementById("inputData").value = "";
}
</script>

</body>
</html>
