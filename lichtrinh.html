<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n l√Ω l·ªãch tr√¨nh</title>

<style>
    /* ==============================
       N√öT H∆Ø·ªöNG D·∫™N
    =============================== */
    #helpBtn {
        position: fixed;
        top: 15px;
        right: 15px;
        padding: 12px 20px;
        background: #ff9800;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
        z-index: 11000;
        width: 140px;
    }

    #hideHelpBtn {
        position: fixed;
        top: 15px;
        right: 165px;
        padding: 12px 18px;
        background: #ca2222;
        color:white;
        border:none;
        border-radius:10px;
        font-size:18px;
        cursor:pointer;
        z-index:11000;
        font-weight: 600;
        width: 60px;
    }

    #helpOverlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 12000;
        padding: 10px;
    }
    #helpOverlay video {
        width: 95%;
        max-height: 75%;
        border-radius: 12px;
    }

    #closeHelp {
        margin-top: 20px;
        padding: 14px 20px;
        background: #e53935;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 20px;
        cursor: pointer;
    }

    /* ==============================
       GIAO DI·ªÜN CHUNG
    =============================== */
    body {
        font-family: Arial;
        background: #6deb93;
        padding: 12px;
        font-size: 18px;
    }

    .container {
        width: 100%;
        background: rgb(238, 221, 190);
        padding: 18px;
        margin: auto;
        border-radius: 12px;
        box-shadow: 0 0 10px #0003;
    }

    input, button {
        padding: 14px;
        margin: 10px 0;
        width: 100%;
        font-size: 18px;
        border-radius: 8px;
    }

    /* ==============================
       THANH TR√äN
    =============================== */
    #topbar {
        display: flex;
        justify-content: space-between;
        margin-bottom: 18px;
        background: #6064a7;
        padding: 14px;
        border-radius: 10px;
        font-weight: bold;
        color: bisque;
        font-size: 20px;
    }

    #dangxuat {
        background: red;
        color: white;
        width: auto;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
    }

    /* ==============================
       L·ªäCH TRONG NG√ÄY
    =============================== */
    #thuHienTai {
        font-weight: bold;
        margin-bottom: 12px;
        color: #333;
        font-size: 20px;
    }

    .lich-item {
        background: #f0f0f0;
        padding: 12px;
        margin: 10px 0;
        border-radius: 8px;
        font-size: 18px;
    }

    .btn-small {
        padding: 10px 14px;
        width: auto;
        margin-right: 10px;
        font-size: 17px;
    }

    /* ==============================
       POPUP S·ª¨A
    =============================== */
    #popupSua {
        display:none;
        position: fixed;
        top: 0; left:0;
        width: 100%; height:100%;
        background: rgba(0,0,0,0.4);
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    #khungSua {
        background: white;
        padding: 25px;
        width: 92%;
        border-radius: 12px;
        font-size: 18px;
    }

    /* ==============================
       PH·∫¶N 7 NG√ÄY T·ªöI
    =============================== */
    .ngay7 {
        background: rgba(255, 255, 255, 0.95);
        padding: 16px;
        margin-bottom: 15px;
        border-radius: 12px;
        font-size: 20px;
        line-height: 1.6;
    }

    .lich7 {
        background: #f9f2c8;
        padding: 10px 12px;
        margin: 8px 0;
        border-radius: 6px;
        font-size: 19px;
    }

    /* ==============================
       T·ªêI ∆ØU CHO ƒêI·ªÜN THO·∫†I
    =============================== */
    @media (max-width: 600px) {
        body { font-size: 20px; }

        #helpBtn, #hideHelpBtn {
            font-size: 20px;
            padding: 14px;
        }

        #topbar {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }

        .btn-small {
            font-size: 20px;
            padding: 12px 16px;
        }

        input, button {
            font-size: 20px;
            padding: 16px;
        }

        .lich-item { font-size: 20px; }
        .lich7 { font-size: 20px; }
        .ngay7 { font-size: 22px; }
    }
</style>

</head>
<body>
  


<div class="container">
   
<button id="hideHelpBtn" onclick="hideHelpBtnFunction()">X</button>

<!-- N√öT H∆Ø·ªöNG D·∫™N -->
<button id="helpBtn" onclick="showHelp()">H∆∞·ªõng d·∫´n</button>

<!-- OVERLAY VIDEO -->
<div id="helpOverlay">
    <video id="helpVideo" controls>
        <source src="qu·∫£n l√Ω l·ªãch tr√¨nh.mp4" type="video/mp4">
    </video>
    <button id="closeHelp" onclick="closeHelp()" style="width: 80px;">ƒê√≥ng</button>
</div>

    <!-- Thanh t√™n + ƒëƒÉng xu·∫•t -->
    <div id="topbar">
        <span id="ten_hien_thi">T√†i kho·∫£n: ...</span>
        <button id="dangxuat">ƒêƒÉng xu·∫•t</button>
    </div>

    <div style="width: 50px;background-color: black;padding: 5px; border-radius: 10px;">
        <a href="trangchu.html"><img src="ngoinha.jpg" width="100%" style="border-radius: 10px;"></a>
        <a href="tienichmorong.html"><img src="muiten.jpg" width="100%" style="border-radius: 10px; margin-top: 20px;"></a>
    </div>

    <h2>Qu·∫£n l√Ω l·ªãch tr√¨nh</h2>

    <label style="font-weight: 600;">Ch·ªçn ng√†y:</label><br>

    <input type="date" id="chonNgay" style="width: 90%;">

    <div id="thuHienTai"></div>

    <div id="formNhap" style="display:none;">
        <label>Gi·ªù:</label>
        <input type="time" id="gio">

        <label>N·ªôi dung:</label>
        <input type="text" id="noidung">

        <button onclick="luuLichTrinh()" style="background-color: #f1e497;color: rgb(18, 18, 20);">L∆∞u l·ªãch tr√¨nh</button>
    </div>

    <h3>L·ªãch trong ng√†y</h3>
    <div id="lichTrongNgay"></div>

    <hr>

    <button onclick="xem7Ngay()" style="background-color: #aad6f0;">Xem l·ªãch tr√¨nh 7 ng√†y t·ªõi</button>
    <div id="ketQua" style="margin-top:20px;"></div>
    <button onclick="xemTatCaLich()" style="background-color: #ffcf96; margin-top:10px;">Xem l·ªãch tr√¨nh ƒë√£ ƒë·∫∑t</button>
<div id="tatCaLich" style="margin-top:20px;"></div>

</div>

<!-- Popup s·ª≠a l·ªãch -->
<div id="popupSua">
    <div id="khungSua">
        <h3>S·ª≠a l·ªãch tr√¨nh</h3>

        <label>Gi·ªù:</label>
        <input type="time" id="editGio">

        <label>N·ªôi dung:</label>
        <input type="text" id="editNoiDung">

        <button onclick="capNhatLich()">C·∫≠p nh·∫≠t</button>
        <button onclick="dongPopup()">H·ªßy</button>
    </div>
</div>

<script>
    function showHelp(){
    document.getElementById("helpOverlay").style.display = "flex";
    const v=document.getElementById("helpVideo");
    v.currentTime = 0;
    v.play();
}

function closeHelp(){
    document.getElementById("helpOverlay").style.display = "none";
    document.getElementById("helpVideo").pause();
}

// ·∫®N C·∫¢ 2 N√öT
function hideHelpBtnFunction(){
    document.getElementById("helpBtn").style.display = "none";
    document.getElementById("hideHelpBtn").style.display = "none";
}
    // =============================
//  Xem to√†n b·ªô l·ªãch ƒë√£ ƒë·∫∑t
// =============================
function xemTatCaLich() {
    let div = document.getElementById("tatCaLich");
    div.innerHTML = "";

    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");

    // L·ªçc l·ªãch theo user
    let list = ds.filter(item => item.user === user);

    if (list.length === 0) {
        div.innerHTML = "<h3>Ch∆∞a c√≥ l·ªãch n√†o!</h3>";
        return;
    }

    // S·∫Øp x·∫øp theo ng√†y + gi·ªù
    list.sort((a, b) => {
        if (a.ngay === b.ngay) return a.gio.localeCompare(b.gio);
        return a.ngay.localeCompare(b.ngay);
    });

    let html = "<h3>T·∫§T C·∫¢ L·ªäCH ƒê√É ƒê·∫∂T</h3>";

    let ngayHienTai = "";

    list.forEach(item => {
        if (item.ngay !== ngayHienTai) {
            ngayHienTai = item.ngay;
            html += `<div class="ngay7"><b>${item.ngay} (${layThu(item.ngay)})</b><br>`;
        }

        html += `<div class="lich7">‚è∞ ${item.gio} ‚Äî ${item.noidung}</div>`;
    });

    html += "</div>";
    div.innerHTML = html;
}

// =============================
//   KI·ªÇM TRA ƒêƒÇNG NH·∫¨P
// =============================
let user = localStorage.getItem("dangnhap_hien_tai");

if (!user) {
    alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p!");
    window.location.href = "dangnhap.html";
}

// Hi·ªán t√™n ng∆∞·ªùi d√πng
document.getElementById("ten_hien_thi").innerText = "T√†i kho·∫£n: " + user;

// N√∫t ƒëƒÉng xu·∫•t
document.getElementById("dangxuat").addEventListener("click", () => {
    localStorage.removeItem("dangnhap_hien_tai");
    alert("ƒê√£ ƒëƒÉng xu·∫•t!");
    window.location.href = "trangchu.html";
});

// =============================
//   H√†m ƒë·ªïi ng√†y sang TH·ª®
// =============================
function layThu(dateStr) {
    let d = new Date(dateStr);
    let thu = d.getDay();
    const tenThu = ["Ch·ªß nh·∫≠t","Th·ª© 2","Th·ª© 3","Th·ª© 4","Th·ª© 5","Th·ª© 6","Th·ª© 7"];
    return tenThu[thu];
}

// =============================
//   Khi ch·ªçn ng√†y
// =============================
document.getElementById("chonNgay").addEventListener("change", function() {
    let ngay = this.value;
    if (ngay) {
        document.getElementById("thuHienTai").innerText = "üìÖ " + layThu(ngay);
        document.getElementById("formNhap").style.display = "block";
        hienLichTrongNgay();
    }
});

// =============================
//   L∆∞u l·ªãch v√†o LocalStorage
// =============================
function luuLichTrinh() {
    let ngay = document.getElementById("chonNgay").value;
    let gio = document.getElementById("gio").value;
    let noidung = document.getElementById("noidung").value;

    if (!ngay || !gio || !noidung) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß!");
        return;
    }

    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");

    ds.push({ user, ngay, gio, noidung });

    localStorage.setItem("lichtrinh", JSON.stringify(ds));

    alert("ƒê√£ l∆∞u!");
    document.getElementById("gio").value = "";
    document.getElementById("noidung").value = "";

    hienLichTrongNgay();
}

// =============================
//   Hi·ªán l·ªãch trong ng√†y
// =============================
let idDangSua = -1;

function hienLichTrongNgay() {
    let ngay = document.getElementById("chonNgay").value;
    let lichDiv = document.getElementById("lichTrongNgay");

    if (!ngay) return;

    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");

    let lich = ds.filter((l, index) => {
        l.index = index;
        return l.user === user && l.ngay === ngay;
    });

    lichDiv.innerHTML = "";

    if (lich.length === 0) {
        lichDiv.innerHTML = "<i>Kh√¥ng c√≥ l·ªãch</i>";
        return;
    }

    lich.forEach(item => {
        lichDiv.innerHTML += `
            <div class="lich-item">
                <b>${item.gio}</b> ‚Äî ${item.noidung}<br>
                <button class="btn-small" onclick="moPopupSua(${item.index})">S·ª≠a</button>
                <button class="btn-small" onclick="xoaLich(${item.index})">X√≥a</button>
            </div>
        `;
    });
}

// =============================
//   X√≥a l·ªãch
// =============================
function xoaLich(idx) {
    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");
    ds.splice(idx, 1);
    localStorage.setItem("lichtrinh", JSON.stringify(ds));

    hienLichTrongNgay();
    alert("ƒê√£ x√≥a!");
}

// =============================
//   Popup s·ª≠a l·ªãch
// =============================
function moPopupSua(idx) {
    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");
    let item = ds[idx];

    idDangSua = idx;

    document.getElementById("editGio").value = item.gio;
    document.getElementById("editNoiDung").value = item.noidung;

    document.getElementById("popupSua").style.display = "flex";
}

function dongPopup() {
    document.getElementById("popupSua").style.display = "none";
}

// =============================
//   C·∫≠p nh·∫≠t l·ªãch
// =============================
function capNhatLich() {
    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");

    ds[idDangSua].gio = document.getElementById("editGio").value;
    ds[idDangSua].noidung = document.getElementById("editNoiDung").value;

    localStorage.setItem("lichtrinh", JSON.stringify(ds));

    alert("ƒê√£ c·∫≠p nh·∫≠t!");
    dongPopup();
    hienLichTrongNgay();
}

// =============================
//  Xem 7 ng√†y t·ªõi (ƒë√£ th√™m n·ªÅn + ch·ªØ to)
// =============================
function xem7Ngay() {
    let ketQua = document.getElementById("ketQua");
    ketQua.innerHTML = "";

    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");
    let html = "<h3>L·ªãch 7 ng√†y t·ªõi:</h3>";

    let today = new Date();

    for (let i = 0; i < 7; i++) {
        let d = new Date();
        d.setDate(today.getDate() + i);

        let ngayISO = d.toISOString().split("T")[0];
        let thu = layThu(ngayISO);

        html += `<div class="ngay7"><b>${ngayISO} (${thu})</b><br>`;

        let list = ds.filter(item => item.user === user && item.ngay === ngayISO);

        if (list.length === 0) {
            html += "<i>Kh√¥ng c√≥ l·ªãch</i></div>";
        } else {
            list.forEach(item => {
                html += `<div class="lich7">‚è∞ ${item.gio} ‚Äî ${item.noidung}</div>`;
            });
            html += "</div>";
        }

        html += "<br>";
    }

    ketQua.innerHTML = html;
}
</script>

</body>
</html>
