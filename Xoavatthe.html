<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xo√° v·∫≠t th·ªÉ AI (Frontend)</title>
<style>
body{font-family:system-ui;background:#eef2f7;margin:0;padding:20px;}
.container{max-width:900px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,0.15);}
h1{text-align:center;}
canvas{border:1px solid #ccc; cursor:crosshair;}
.buttons{margin-top:10px;}
button{padding:10px 16px;margin-right:10px;border:none;border-radius:6px;cursor:pointer;}
.primary{background:#0b69ff;color:white;}
.danger{background:#ff4d4d;color:white;}
</style>
</head>
<body>
<div class="container">
<h1>Xo√° v·∫≠t th·ªÉ AI (Ch·ªâ Frontend)</h1>
<label>üì§ T·∫£i ·∫£nh l√™n:</label>
<input type="file" id="fileInput" accept="image/*">

<p>V·∫Ω v√πng c·∫ßn xo√° b·∫±ng chu·ªôt (brush ƒë·ªè)</p>
<canvas id="editCanvas" width="512" height="512"></canvas>
<canvas id="maskCanvas" width="512" height="512" style="display:none;"></canvas>

<div class="buttons">
  <button id="eraseBtn" class="primary">üßπ Xo√° v·∫≠t th·ªÉ</button>
  <button id="resetBtn" class="danger">üîÑ Reset ·∫£nh</button>
  <button id="downloadBtn">‚¨áÔ∏è T·∫£i ·∫£nh</button>
</div>

<p style="color:red">‚ö†Ô∏è L∆ØU √ù: API key s·∫Ω hi·ªÉn th·ªã trong code, KH√îNG d√πng cho production!</p>

<script>
const API_KEY = "YOUR_OPENAI_API_KEY_HERE"; // ‚ö†Ô∏è C·∫£nh b√°o: kh√¥ng d√πng key th·∫≠t tr√™n production
const fileInput = document.getElementById('fileInput');
const editCanvas = document.getElementById('editCanvas');
const maskCanvas = document.getElementById('maskCanvas');
const ctx = editCanvas.getContext('2d');
const maskCtx = maskCanvas.getContext('2d');
let img = new Image();
let drawing=false;

// Load ·∫£nh
fileInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  img.src = URL.createObjectURL(file);
});
img.onload = ()=>{
  editCanvas.width = img.width;
  editCanvas.height = img.height;
  maskCanvas.width = img.width;
  maskCanvas.height = img.height;
  ctx.drawImage(img,0,0);
  maskCtx.clearRect(0,0,maskCanvas.width,maskCanvas.height);
};

// V·∫Ω mask
editCanvas.addEventListener('mousedown',()=>drawing=true);
editCanvas.addEventListener('mouseup',()=>drawing=false);
editCanvas.addEventListener('mouseout',()=>drawing=false);
editCanvas.addEventListener('mousemove', e=>{
  if(!drawing) return;
  const rect = editCanvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  ctx.fillStyle='rgba(255,0,0,0.5)';
  ctx.beginPath();
  ctx.arc(x,y,20,0,Math.PI*2);
  ctx.fill();
  maskCtx.fillStyle='white';
  maskCtx.beginPath();
  maskCtx.arc(x,y,20,0,Math.PI*2);
  maskCtx.fill();
});

// Xo√° v·∫≠t th·ªÉ b·∫±ng AI
document.getElementById('eraseBtn').addEventListener('click', async ()=>{
  const imageBlob = await new Promise(res=>editCanvas.toBlob(res,'image/png'));
  const maskBlob = await new Promise(res=>maskCanvas.toBlob(res,'image/png'));
  
  const formData = new FormData();
  formData.append('image', imageBlob, 'image.png');
  formData.append('mask', maskBlob, 'mask.png');
  formData.append('prompt', 'Kh√¥i ph·ª•c ph·∫ßn ·∫£nh b·ªã xo√° t·ª± nhi√™n');
  formData.append('size', '1024x1024');

  const btn = document.getElementById('eraseBtn');
  btn.disabled=true;
  btn.textContent='‚è≥ ƒêang x·ª≠ l√Ω...';

  try {
    const res = await fetch('https://api.openai.com/v1/images/edits', {
      method:'POST',
      headers:{ 'Authorization': 'Bearer '+API_KEY },
      body:formData
    });
    const data = await res.json();
    const base64 = data.data[0].b64_json;
    const imageSrc = "data:image/png;base64,"+base64;
    const resultImg = new Image();
    resultImg.onload=()=>{
      editCanvas.width=resultImg.width;
      editCanvas.height=resultImg.height;
      ctx.drawImage(resultImg,0,0);
      maskCtx.clearRect(0,0,maskCanvas.width,maskCanvas.height);
      btn.disabled=false;
      btn.textContent='üßπ Xo√° v·∫≠t th·ªÉ';
    }
    resultImg.src=imageSrc;
  } catch(err){
    alert('L·ªói AI');
    btn.disabled=false;
    btn.textContent='üßπ Xo√° v·∫≠t th·ªÉ';
  }
});

// Reset
document.getElementById('resetBtn').addEventListener('click',()=>{
  ctx.drawImage(img,0,0);
  maskCtx.clearRect(0,0,maskCanvas.width,maskCanvas.height);
});

// Download
document.getElementById('downloadBtn').addEventListener('click',()=>{
  editCanvas.toBlob(blob=>{
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download="edited.png";
    a.click();
  });
});
</script>
</body>
</html>
